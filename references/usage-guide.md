# Content Series Generator V2 - 使用指南

## 快速开始

### 1. 创建系列文章

直接对 Claude 说：

```
"创建一个关于AI制造业的系列文章，10篇，每篇3500字"
```

Claude 会自动：
- ✅ 初始化系列（生成唯一ID）
- ✅ 尝试搜索最新新闻（失败则使用知识库）
- ✅ 生成智能大纲（包含关键词和受众分析）
- ✅ 创建任务列表追踪进度
- ✅ 逐篇生成文章
- ✅ 使用描述性文件名保存：`{标题}_{时间戳}.md`
- ✅ 发布到 B4A 平台
- ✅ 返回所有文章 URL

### 2. 查看系列状态

```
"显示 series-20260221-a1b2 的状态"
```

### 3. 继续未完成的系列

```
"继续生成 series-20260221-a1b2，从第5篇开始"
```

### 4. 重新生成单篇文章

```
"重新生成 series-20260221-a1b2 的第3篇，增加更多数据"
```

## 核心特性

### 🎯 智能大纲生成

**包含内容：**
- 关键词研究（SEO优化）
- 受众分析（目标读者画像）
- 文章结构（逻辑递进）
- 新闻整合（最新趋势，带容错）

**示例大纲：**
```json
{
  "topic": "AI制造业转型",
  "keywords": ["智能制造", "数字化转型", "工业4.0"],
  "audience": "制造业管理者和决策者",
  "news_integrated": true,
  "articles": [
    {
      "number": 1,
      "title": "AI制造业转型指南",
      "subtitle": "从传统到智能的跨越",
      "key_points": [
        "AI在制造业的应用现状",
        "转型的关键挑战",
        "成功案例分析"
      ]
    }
  ]
}
```

### 📁 描述性文件命名

**格式：** `{文章标题}_{YYYYMMDD}_{HHMMSS}.md`

**示例：**
```
AI制造业转型指南_20260221_170315.md
智能工厂实施路径_20260221_170820.md
数字化转型案例分析_20260221_171205.md
```

**优势：**
- ✅ 一眼看出文章内容
- ✅ 按时间排序
- ✅ 支持中英文标题
- ✅ 自动清理特殊字符

### 🔄 新闻整合策略

**主要方式：WebSearch**
```javascript
try {
  // 尝试搜索最新新闻
  const news = await WebSearch({
    query: `${topic} 最新趋势 2026`,
    limit: 5
  });
  // 整合到大纲中
} catch (error) {
  // 自动降级到知识库
}
```

**降级方案：知识库生成**
- 使用 Claude 训练数据
- 聚焦永恒原则和框架
- 添加信息时效性声明
- 仍然生成高质量内容

**状态标记：**
- `metadata.json` → `news_source: "websearch"` 或 `"fallback"`

### 🛡️ 错误处理

**网络失败**
- WebSearch 超时 → 自动降级
- B4A 发布失败 → 重试3次（指数退避）
- 所有错误记录到 `errors.log`

**生成中断**
- 每篇文章生成后立即保存
- 从最后完成的文章恢复
- 不会丢失任何数据

**验证机制**
- 字数检查（±10% 容差）
- 文件保存验证
- 发布响应确认

## 数据结构

### 目录布局

```
E:\AICoding\article\
└── series-20260221-a1b2/
    ├── metadata.json              # 系列元数据
    ├── outline.json               # 生成的大纲
    ├── errors.log                 # 错误日志（如有）
    ├── AI制造业转型指南_20260221_170315.md
    ├── 智能工厂实施路径_20260221_170820.md
    └── ...
```

### metadata.json

```json
{
  "id": "series-20260221-a1b2",
  "topic": "AI制造业转型",
  "created_at": "2026-02-21T17:03:15+08:00",
  "articles_count": 10,
  "words_per_article": 3500,
  "style": "soul-scribe-c",
  "status": "published",
  "news_source": "websearch",
  "published_urls": [
    {
      "number": 1,
      "title": "AI制造业转型指南",
      "url": "https://b4a.app/...",
      "filename": "AI制造业转型指南_20260221_170315.md"
    }
  ]
}
```

## 写作风格

### soul-scribe-c（默认）
- 开头摘要表格
- 场景化引入
- 数据深度分析
- 实用建议
- 对话式语气

### formal（正式）
- 专业商务写作
- 数据驱动论证
- 执行摘要
- 清晰结构

### casual（轻松）
- 对话式友好
- 个人轶事
- 易懂语言
- 吸引人的语气

### technical（技术）
- 深度技术分析
- 代码示例
- 架构图
- 实现细节

## 使用场景

### 场景1：基础系列创建

```
用户："创建制造业AI系列，10篇，3500字"

Claude 执行：
1. 初始化 series-20260221-a1b2
2. 尝试新闻研究
3. 生成10篇文章大纲
4. 创建10个任务追踪
5. 逐篇生成文章
6. 保存为描述性文件名
7. 发布到 B4A
8. 返回所有 URL
```

### 场景2：自定义风格

```
用户："创建技术趋势系列，5篇，4000字，技术风格"

Claude 执行：
- 使用 technical 写作风格
- 包含代码示例
- 深度技术分析
- 每篇4000字
```

### 场景3：恢复中断的系列

```
用户："继续 series-20260221-a1b2，从第5篇开始"

Claude 执行：
- 加载现有系列
- 检查已完成文章（1-4）
- 从第5篇恢复
- 继续到完成
```

### 场景4：重新生成单篇

```
用户："重新生成 series-20260221-a1b2 的第3篇，增加更多数据"

Claude 执行：
- 加载第3篇大纲
- 重新生成（强调数据）
- 保存为新时间戳
- 可选择重新发布
```

## 故障排查

### WebSearch 不可用

**症状：** 日志中显示 "WebSearch failed"

**解决：** 自动降级到知识库生成

**影响：** 内容仍然高质量，可能缺少最新新闻

**检查：** `metadata.json` → `news_source: "fallback"`

### B4A 发布失败

**症状：** 特定文章显示 "Publish failed"

**解决方案：**
1. 检查 slash-b4a 技能中的 B4A 凭证
2. 重试单篇文章：
   ```bash
   node ~/.claude/skills/content-series-generator-v2/scripts/publish-series-v2.js series-20260221-a1b2 --article=3
   ```
3. 检查网络连接
4. 查看 `errors.log` 了解详情

### 文件命名问题

**症状：** 文件名中有特殊字符

**解决：** `generateDescriptiveFilename()` 自动清理

**允许：** 中文、英文、数字、连字符、下划线

**移除：** `< > : " / \ | ? *`

### 生成中断

**症状：** 系列未完成

**解决：** 使用 "继续 series-{id}" 恢复

**恢复：** 所有已完成文章保留

**检查：** 任务列表查看进度状态

## 最佳实践

1. **生成前审查大纲**
   - 节省时间，如需调整
   - 确保内容方向正确

2. **监控第一篇文章**
   - 验证风格和质量
   - 批量生成前调整

3. **检查文件名**
   - 确保标题描述性强
   - 验证无重复名称

4. **发布前备份**
   - 系列数据在 `E:\AICoding\article\`
   - 需要时可重新发布

5. **先测试小系列**
   - 尝试3篇文章再做10+篇
   - 验证工作流和质量

## V1 vs V2 对比

| 功能 | V1 | V2 |
|------|----|----|
| 大纲生成 | 基础 | 智能（带研究） |
| 新闻整合 | ❌ | ✅ 带降级 |
| 文件命名 | `01.md` | `{标题}_{时间}.md` |
| 错误处理 | 基础 | 健壮（带重试） |
| 进度追踪 | 手动 | 基于任务 |
| 恢复能力 | 有限 | 完全支持 |
| 错误日志 | ❌ | ✅ `errors.log` |
| 验证 | ❌ | ✅ 字数检查 |

## 技术细节

### 脚本说明

**generate-outline-v2.js**
- 初始化系列
- 准备大纲生成
- 设置元数据

**generate-content-v2.js**
- 加载文章信息
- 准备内容生成
- 验证大纲

**publish-series-v2.js**
- 批量发布文章
- 重试失败发布（3次）
- 收集并返回 URL
- 更新元数据

**utils-v2.js**
- `generateDescriptiveFilename()` - 创建描述性文件名
- `attemptWithFallback()` - 主方案失败时降级
- `retryWithBackoff()` - 指数退避重试
- `validateArticle()` - 验证文章质量
- `appendLog()` - 错误日志记录

## 支持

遇到问题时：
1. 检查 `E:\AICoding\article\{series-id}\errors.log`
2. 查看 `metadata.json` 了解状态
3. 验证任务列表查看进度
4. 如发布失败，检查 B4A 凭证

## 版本信息

**当前版本：** V2.0.0

**主要改进：**
- 智能大纲（带新闻研究）
- WebSearch 失败的优雅降级
- 描述性文件命名：`{标题}_{时间}.md`
- 增强的错误处理和重试逻辑
- 基于任务的进度追踪

**上一版本：** V1.0.0 - 基础系列生成
